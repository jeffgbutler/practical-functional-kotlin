<html>
<head>
<title>Practical Functional Java</title>
<link rel="stylesheet" href="reveal.js-3.6.0/css/reveal.css">
<link rel="stylesheet" href="reveal.js-3.6.0/css/theme/moon.css">
<link rel="stylesheet" href="reveal.js-3.6.0/lib/css/obsidian.css">
<link rel="stylesheet" href="css/style.css">
</head>
<body>
  
  <div class="reveal">
    <div class="slides">

      <section>
        <h2>Practical Functional Kotlin</h2>
        <h3>Kotlin Overview</h3>
        <h4>Jeff Butler</h4>
        <p>https://github.com/jeffgbutler/practical-functional-kotlin</p>
        <p>https://jeffgbutler.github.io/practical-functional-kotlin/</p>
      </section>

      <section>
        <h3>My Dilemma</h3>
        <p>How do I teach a new programming language in an hour?</p>
        <p>Answer - I don't</p>
        <p>This talk is a little bit about why I think Kotlin is important, and then we'll do a whirl wind tour of some code</p> 
      </section>
      
      <section>
        <h3>Java is not just about Java</h3>
        <blockquote>
          "Most people talk about Java the language, and this may sound odd coming from me, but I could
          hardly care less. At the core of the Java ecosystem is the JVM."
        </blockquote>
        <blockquote>
          James Gosling, Creator of the Java Programming Language(2011, TheServerSide.com)
        </blockquote>
      </section>
      
      <section>
        <h3>What's Right with Java?</h3>
        <ul>
          <li>The JVM runs on virtually every platform - from your credit card to the largest mainframe</li>
          <li>Cross platform compatibility has been a hallmark of Java from the very beginning</li>
          <li>Huge investment in a highly stable and performant runtime</li>
          <li>Many important and large systems are written in Java</li>
          <li>The open source movement flourished with Java</li>
          <li>Many important architectural concepts in use today have come from the Java/Open Source space</li>
        </ul>
      </section>
      
      <section>
        <h3>What's Wrong with Java?</h3>
        <ul>
          <li>Many Java code bases are unmitigated disasters</li>
          <li>Many Java developers are undisciplined</li>
          <li>Enterprise systems - EJBs, WebSphere, etc.</li>
          <li>The Java language suffered from years of inattention</li>
          <li>Java 8 is great, but very late and many clients have not upgraded</li>
        </ul>
        <blockquote>
         Java is a good language...there are some issues...you can make things as God awful as you want...
         it does allow people to create incredible messes (Gosling) 
        </blockquote>
      </section>

      <section>
        <p>Kotlin is one of the most Java-ish things ever to happen to Java</p>
        <p>What do I mean?</p>
      </section>
      
      <section>
        <h3>Java developers are skeptical...</h3>
        <ul>
          <li>We dislike the date/time API -> JodaTime</li>
          <li>We dislike Core J2EE Patterns, EJBs, and JSF -> Spring Framework</li>
          <li>We dislike Entity EJBs -> Hibernate</li>
          <li>We dislike WebSphere -> JBoss</li>
          <li>We dislike the Java language...</li>
        </ul>
      </section>

      <section>
        <h3>Other JVM Languages</h3>
        <ul>
          <li>Groovy (Dynamic) - Pivotal donated to Apache where projects go to die</li>
          <li>Clojure (Lisp on JVM)</li>
          <li>Scala (static types, functional, ML on the JVM)</li>
          <li>Dozens more</li>
        </ul>
        <p>¯\_(ツ)_/¯</p>
      </section>
      
      <section>
        <h3>Along Comes Kotlin</h3>
        <p>I dream that late one night, some JetBrains folks decide they have
          finally had enough of Java's lethargy. They figure they can build something better.</p> 
      </section>
      
      <section>
        <h3>Kotlin Milestones</h3>
        <ul>
          <li>July 2011: Announced by JetBrains</li>
          <li>February 2012: Open Sourced with Apache license</li>
          <li>February 2016: Kotlin 1.0 Announced</li>
          <li>March 2017: Kotlin 1.1 - JavaScript target environment</li>
          <li>May 2017: Google announces first class support for Kotlin on Android</li>
          <li>November 2017: Kotlin 1.2 - Shared Code Between JVM and JS</li>
          <li>December 2017: Pivotal announces first class support for Kotlin in Spring Development</li>  
        </ul>
      </section>

      <section>
        <h3>Why Kotlin?</h3>
        <ul>
          <li>Kotlin is not an academic language - it is practical</li>
          <li>Kotlin does not make you change the way you think (unlike Scala and Clojure)</li>
          <li>Seamless Java interop (the killer feature)</li>
          <li>Makes Android development less painful (Android is the killer app for Kotlin)</li>
          <li>JDK 6!</li>
        </ul>
      </section>
      
      <section>
        <h3>Building Kotlin</h3>
        <ul>
          <li>Same structure as Java - packages, classes, etc.</li>
          <li>Builds with Maven/Gradle/Ant</li>
          <li>Java and Kotlin can live side by side in the same project</li>
        </ul>
      </section>
      
      <section>
        <h3>Is it Just Syntax Sugar?</h3>
        <p>In some ways, Kotlin is all about syntax sugar</p>
        <p>Some of it is a little like Lombok - but not really</p>
        <p>All high level languages are just syntax sugar for assembler anyway - so we'll just get over it :)</p>
      </section>
      
      <section>
        <h3>Kotlin Language Features</h3>
        <ul>
          <li>Semicolons are optional and discouraged</li>
          <li>Multiple classes in files</li>
          <li>Very relaxed about classes, file names, etc.</li>
          <li>Codifies many conventions leading to more concise code</li>
          <li>Type inference</li>
          <li>Lambdas before Java 8</li>
          <li>Null Safety</li>
          <li>Pimp my library</li>
          <li>DSL Construction</li>
        </ul>
      </section>
      
      <section>
        <h3>Tour of Kotlin</h3>
        <p>Now we'll look at some code...</p>
      </section>

      <section>
        <h3>Variable Declaration</h3>
        <pre>
          <code class="kotlin">
    val foo = "Fred"  // String type inferred, immutable, non-nullable
    var bar = "Barney"  // String type inferred, mutable, non-nullable
    var baz: String? = "Betty" // String type, mutable, nullable
          </code>
        </pre>
        <p>Variables do not need to be in a class!</p>
      </section>
      
      <section>
        <h3>Function Definition</h3>
        <pre>
          <code class="kotlin">
    fun helloWorld1(s: String): Unit {  // Unit is like void, and not necessary in this case
        println(s)
    }

    fun helloWorld2(s: String) = println(s)  // one line functions don't need braces

    fun add1(a: Int, b: Int): Int {
        return a + b
    }

    fun add2(a: Int, b: Int) = a + b  // return type of Int is inferred
          </code>
        </pre>
        <p>Functions do not need to be in a class!</p>
      </section>
      
      <section>
        <h3>Simple Classes</h3>
        <pre>
          <code class="kotlin">
    class MyCalculator1 (val firstName: String, val lastName: String) {
        fun getFullName() = firstName + " " + lastName  // don't do this!
    }
          </code>
        </pre>
        <p align="left">Notes:</p>
        <ul style="font-size: smaller">
          <li>Classes are public by default</li>
          <li>Functions are public by default</li>
          <li>Constructor takes two non-nullable strings</li>
          <li>Automatic getters for the constructor parameters</li>
          <li>This is not the way to write a getter in Kotlin!</li> 
        </ul>
      </section>

      <section>
        <h3>Interfaces</h3>
        <pre>
          <code class="kotlin">
    interface Friendly {
        fun sayHello(): String

        fun isFriendly() = true
    }
          </code>
        </pre>
        <p align="left">Notes:</p>
        <ul>
          <li>Interfaces are public by default</li>
          <li>Functions are public by default</li>
          <li>Methods can be abstract, or can have an implementation (like Java8 Default methods)</li>
          <li>Methods can be private (like Java9)</li>
        </ul>
      </section>
       
      <section>
        <h3>Classes</h3>
        <pre>
          <code class="kotlin">
    class MyCalculator2 (val firstName: String, val lastName: String) : Friendly {
        override fun sayHello(): String {
            return "Hi!  My name is " + fullName
        }

        val fullName: String
            get() = firstName + " " + lastName  // a "getter" in Kotlin
    }
          </code>
        </pre>
        <p align="left">Notes:</p>
        <ul style="font-size: smaller">
          <li>Implements Friendly, overrides sayHello()</li>
          <li>A more idiomatic Kotlin "getter"</li>
        </ul>
      </section>

      <section>
        <h3>Data Classes</h3>
        <pre>
          <code class="kotlin">
    data class Person(val firstName : String, val lastName : String)
          </code>
        </pre>
        <p align="left">This class ...</p>
        <ul>
          <li>is public, final</li>
          <li>is null safe</li>
          <li>is immutable</li>
          <li>has getters, toString, equals, hashCode</li>
          <li>has copy functions</li>
          <li>has destructuring functions</li>
        </ul>
      </section>
      
      <section>
        <h3>If Expressions</h3>
        <div class="left">
          <p align="center">Java</p>
          <pre>
            <code class="java" data-trim>
    public String renderGreeting(Boolean isFriendly) {
        if (isFriendly) {
            return "Hello!";
        } else {
            return "Go Away!";
        }
    }
            </code>
          </pre>
        </div>
        <div class="right">
          <p align="center">Kotlin</p>
          <pre>
            <code class="kotlin" data-trim>
    fun renderGreeting1(friendly: Boolean): String {
        return if (friendly) {
            "Hello!"
        } else {
            "Go Away!"
        }
    }
    
    fun renderGreeting2(friendly: Boolean) =
      if (friendly) "Hello!" else "Go Away!"
            </code>
          </pre>
        </div>
        <p align="left">Notes</p>
        <ul style="font-size: smaller">
          <li>No need to create a variable, or to have multiple return statements</li>
          <li>Because of this, Kotlin does not have a ternary operator</li>
        </ul>
      </section>
      
      <section>
        <h3>When Expressions - A Better Switch</h3>
        <div class="left">
          <p align="center">Java</p>
          <pre>
            <code class="Java" data-trim style="max-height: 450px">
    public String calculateLastName(String firstName) {
      String rc;
      
      switch(firstName) {
      case "Fred":
      case "Wilma":
        rc = "Flintstone";
        break;
        
      case "Barney":
      case "Betty":
        rc = "Rubble";
        break;
      
      default:
        rc = "Unknown";
        break;
      }
      return rc;
    }
            </code>
          </pre>
        </div>
        <div class="right">
          <p align="center">Kotlin</p>
          <pre>
            <code class="kotlin" data-trim>
    fun calculateLastName(firstName: String): String {
        return when(firstName) {
            "Fred", "Wilma" -> "Flintstone"
            "Barney", "Betty" -> "Rubble"
            else -> { // can be a code block
                return "Unknown"
            }
        }
    }

    fun renderLifeStage1(age: Int): String {
        return when(age) {
            in 0..12 -> "Child"
            in 13..19 -> "Teenager"
            else -> "Adult"
        }
    }
            </code>
          </pre>
        </div>
      </section>
      
      <section>
        <h3>When Expressions - Alternate Syntax</h3>
        <pre>
          <code class="kotlin">
    fun renderLifeStage2(age: Int): String {
        return when {
            age < 13 -> "Child"
            age in 13..19 -> "Teenager"
            else -> "Adult"
        }
    }
          </code>
        </pre>
        <p align="left">Note: Any boolean expression is allowed</p>
      </section>

      <section>
        <h3>Sealed Classes</h3>
        <p>Sealed classes create a fixed hierarchy</p>
        <pre>
          <code class="kotlin">
  // all sealed classes must be in the same file...
  sealed class Animal(val name: String)
  class Dog(name: String, val akcNumber: Int) : Animal(name)
  class Cat(name: String, val cfaNumber: Int) : Animal(name)

  fun speak(animal: Animal): String {
      return when (animal) {
          is Dog -> "Bark"
          is Cat -> "Meow"
          // no otherwise/else!
      }
  }

  var myDog = Dog("Bob Barker", 22)  // no new keyword!
  var talk = speak(myDog)   // Bark
          </code>
        </pre>
        <p>Avoids an ugly instanceof check</p>
      </section>
      
      <section>
        <h3>Extension Functions and Smart Casting</h3>
        <pre>
          <code class="kotlin">
  sealed class Animal(val name: String)
  class Dog(name: String, val akcNumber: Int) : Animal(name)
  class Cat(name: String, val cfaNumber: Int) : Animal(name)

  // add an extension method to Animal
  fun Animal.speak(): String {
      return when (this) {
          // string template preview!
          is Dog -> "Bark! My name is $name and my number is $akcNumber"
          is Cat -> "Meow! My name is $name and my number is $cfaNumber"
      }
  }

  var myDog = Dog("Bob Barker", 22)
  var talk = myDog.speak()  // Bark! My name is Bob Barker and my number is 22
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Named Parameters, Default Parameters, Safe Navigation, Elvis</h3>
        <pre>
          <code class="kotlin">
  class Address(val line1: String, val line2: String? = null)
  class Person(val name: String, val homeAddress: Address, val workAddress: Address? = null)

  val bob = Person(homeAddress = Address("Main Street"), name = "Bob")
  
  // nullable
  val bobsWorkAddress1: String? = bob.workAddress?.line2  // type can be inferred
  
  // non-nullable - must have a value
  val bobsWorkAddress2: String = bob.workAddress?.line2 ?: "" // type can be inferred
          </code>
        </pre>
      </section>
      
      <section>
        <h3>String Templates</h3>
        <pre>
          <code class="kotlin">
  val bob = Person(homeAddress = Address("Main Street"), name = "Bob")

  val bobString1 = "My name is ${bob.name}, my home address is ${bob.homeAddress.line1}"

  // triple quoted string - preserves formatting
  val bobString2 = """|My name is "${bob.name}"
                      |  My home address is ${bob.homeAddress.line1}"""
                   .trimMargin("|")   // "|" is default and can be omitted
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Operator Overloading</h3>
        <pre>
          <code class="kotlin">
  class BankAccount (var balance: Double = 0.0){
      operator fun plusAssign(amount: Double) {  // overloads +=
          balance += amount
      }
  }
  
  val myAccount = BankAccount()
  myAccount.plusAssign(22.0)  // non overloaded call
  myAccount += 22.0  // over loaded call
          </code>
        </pre>
        <p align="left">Many operators can be overloaded - some in very clever ways.  For example, if a class
        implements <code>Comparable</code>, you get &lt;, &gt;, &lt;=, &gt;= for free.</p>
        <p align="left">New operators cannot be defined...except infix...</p> 
      </section>
      
      <section>
        <h3>Infix Functions</h3>
        <pre>
          <code class="kotlin">
  class BankAccount (var balance: Double = 0.0){
      infix fun deposit(amount: Double) {
          balance += amount
      }
  
      infix fun `!&amp;%`(amount: Double) {
          balance -= amount
      }
  }
  
  val myAccount = BankAccount()
  myAccount.deposit(22.0)  // non infix call
  myAccount deposit 22.0  // infix call
  myAccount `!&amp;%` 33.0
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Overview of Lambdas</h3>
        <ul>
          <li>Kotlin has "proper" function types - no weird SAM interfaces like Java 8</li>
          <li>Kotlin can interact with Java SAM interfaces mostly automatically</li>
          <li>Map/Filter/Reduce implemented via extension functions on the standard Java collections</li>
          <li>Not lazy by default - so this is purely declarative vs. imperative</li>
          <li>Can be made lazy</li>
          <li>Works in Java 6</li>
        </ul>
      </section>
      
      <section>
        <h3>Simple Lambda</h3>
        <pre>
          <code class="kotlin">
    @Test
    fun `simple lambda`() {
        val names = listOf("Fred", "Wilma", "Barney", "Betty")

        var str = names.filter ({ s -> s.startsWith("B") })
                .joinToString(",")
        assertThat(str).isEqualTo("Barney,Betty")
    }
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Simple Lambda With "it"</h3>
        <pre>
          <code class="kotlin">
    @Test
    fun `lambda with it`() {
        val names = listOf("Fred", "Wilma", "Barney", "Betty")

        var str = names.filter({ it.startsWith("B") })
                .joinToString(",")
        assertThat(str).isEqualTo("Barney,Betty")
    }
          </code>
        </pre>
        <p align="left">Note the "it" variable name</p>
      </section>
      
      <section>
        <h3>Lambda Pipeline</h3>
        <pre>
          <code class="kotlin">
    @Test
    fun `lambda pipeline`() {
        val names = listOf("Fred", "Wilma", "Barney", "Betty")

        var str = names.filter({ it.startsWith("B") })
                .map({ it.toUpperCase() })
                .joinToString(",")
        assertThat(str).isEqualTo("BARNEY,BETTY")
    }
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Combination Functions</h3>
        <pre>
          <code class="kotlin">
    @Test
    fun `lambda combination functions`() {
        val names = listOf("Fred", "Wilma", "Barney", "Betty")

        var str = names.filter({ it.startsWith("B") })
                .joinToString(",", transform = { it.toUpperCase() })
        assertThat(str).isEqualTo("BARNEY,BETTY")
    }
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Lambda Outside Parenthesis</h3>
        <pre>
          <code class="kotlin">
    @Test
    fun `lambda outside parenthesis`() {
        val names = listOf("Fred", "Wilma", "Barney", "Betty")

        var str = names.filter { it.startsWith("B") }
                .map { it.toUpperCase() }
                .joinToString(",")
        assertThat(str).isEqualTo("BARNEY,BETTY")
    }
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Method Reference</h3>
        <pre>
          <code class="kotlin">
    @Test
    fun `method references`() {
        val names = listOf("Fred", "Wilma", "Barney", "Betty")

        var str = names.filter { it.startsWith("B") }
                .map(String::toUpperCase)
                .joinToString(",")
        assertThat(str).isEqualTo("BARNEY,BETTY")
    }
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Function Variables and Local Functions</h3>
        <pre>
          <code class="kotlin">
    @Test
    fun `function variables and local functions`() {
        val upperCase = { s: String -> s.toUpperCase() }  // function variable
        fun String.startsWithB() = startsWith("B")  // local extension function

        val names = listOf("Fred", "Wilma", "Barney", "Betty")

        var str = names.filter { it.startsWithB() }
                .map { upperCase(it) }
                .joinToString(",")
        assertThat(str).isEqualTo("BARNEY,BETTY")
    }
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Higher Order Functions</h3>
        <pre>
          <code class="kotlin">
    @Test
    fun `higher order functions`() {
        val names = listOf("Fred", "Wilma", "Barney", "Betty")

        var str = names.filter { it.startsWith("B") }
                .map(upperCaseIt())
                .joinToString(",")
        assertThat(str).isEqualTo("BARNEY,BETTY")
    }

    private fun upperCaseIt(): (String) -> String = { it.toUpperCase() }
    private fun upperCaseIt2() = { s: String -> s.toUpperCase() }  // using inferred type
          </code>
        </pre>
      </section>
      
      <section>
        <h3>Type Safe Builders and DSL Construction</h3>
        <p>The "crown jewel" of Kotlin.  Uses "clean syntax" features to create a natural looking DSL</p>
        <ul>
          <li>Extension Functions</li>
          <li>Operator overloading</li>
          <li>Infix calls</li>
          <li>Lambdas Outside Parenthesis</li>
          <li>Functions with Receivers (some other talk)</li>
        </ul>
      </section>
      
      <section>
        <h3>DSL Example</h3>
        <pre>
          <code class="kotlin" style="max-height: 600px">
fun result(args: Array&lt;String&gt;) =
    html {
        head {
            title {+"XML encoding with Kotlin"}
        }
        body {
            h1 {+"XML encoding with Kotlin"}
            p  {+"this format can be used as an alternative markup to XML"}

            a(href = "http://kotlinlang.org") {+"Kotlin"}

            p {
                +"This is some"
                b {+"mixed"}
                +"text. For more see the"
                a(href = "http://kotlinlang.org") {+"Kotlin"}
                +"project"
            }
            p {+"some text"}

            p {
                for (arg in args)
                    +arg
            }
        }
    }
          </code>
        </pre>
      </section>
      
      <section>
        <img src="images/Mind-blown.jpg">
      </section>
      
      <section>
        <h3>Next Steps</h3>
        <ul>
          <li>Install an IDE
            <ul>
              <li>IntelliJ IDEA (community edition is OK) - Best</li>
              <li>Eclipse with JetBrains Kotlin Plugin - Not Terrible</li>
              <li>VS Code? No support except syntax highlighting and Maven</li>
            </ul>
          </li>
          <li>Do the Kotlin Koans workshop: https://github.com/Kotlin/kotlin-koans</li>
          <li>Docs: https://kotlinlang.org/docs/reference/</li>
          <li>"Kotlin in Action" - decent book</li>
          <li>Look for seams where Kotlin can fit in to your existing projects (tests are an obvious start)</li>
        </ul>
      </section>
    </div>
  </div>

  <script src="reveal.js-3.6.0/lib/js/head.min.js"></script>
  <script src="reveal.js-3.6.0/js/reveal.js"></script>
  <script>
    Reveal.initialize({
        width: '90%',
        slideNumber: 'c/t',
        dependencies: [
            // Cross-browser shim that fully implements classList - https://github.com/eligrey/classList.js/
            { src: 'reveal.js-3.6.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },

            // Syntax highlight for <code> elements
            { src: 'reveal.js-3.6.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },

            // Zoom in and out with Alt+click
            { src: 'reveal.js-3.6.0/plugin/zoom-js/zoom.js', async: true },

            // Speaker notes
            { src: 'reveal.js-3.6.0/plugin/notes/notes.js', async: true }
        ]
    });
  </script>
</body>
</html>
